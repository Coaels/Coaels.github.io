<!DOCTYPE html>
<html>
<head>
    <title>GitHubç½‘ç›˜</title>
    <style>
        body { margin: 0; font-family: Arial; }
        .header { 
            background: #24292e; 
            color: white; 
            padding: 20px; 
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        .container { 
            display: flex; 
            height: calc(100vh - 80px); 
        }
        .upload-section { 
            width: 30%; 
            padding: 20px; 
            border-right: 1px solid #ddd;
            box-sizing: border-box;
        }
        .list-section { 
            width: 70%; 
            padding: 20px; 
            overflow-y: auto;
            box-sizing: border-box;
        }
        .upload-area { 
            width: 100%; 
            padding: 15px; 
            margin-bottom: 10px;
            border: 2px dashed #ccc;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            box-sizing: border-box;
        }
        .button-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .button-row button {
            flex: 1;
            padding: 10px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .confirm-btn {
            background: #2ea44f;
        }
        .refresh-btn {
            background: #0366d6;
        }
        .file-item { 
            border: 1px solid #e1e4e8; 
            padding: 15px; 
            margin-bottom: 10px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .selected-files {
            max-height: 150px;
            overflow-y: auto;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            background: #f6f8fa;
            box-sizing: border-box;
        }
        .file-info {
            font-size: 12px;
            padding: 2px 0;
        }
        .pagination { 
            margin-top: 20px;
            text-align: center;
        }
        .pagination button { 
            margin: 0 5px; 
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: #f6f8fa;
            cursor: pointer;
        }
        .download-btn {
            padding: 6px 12px;
            background: #2ea44f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 8px;
        }
        .delete-btn {
            padding: 6px 12px;
            background: #cf222e;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .status-msg {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #cce7ff; color: #004085; }
        .notice {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            text-align: center;
            border: 1px solid #ffeaa7;
            box-sizing: border-box;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #2ea44f;
            transition: width 0.3s;
        }
        .version {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 12px;
            color: #666;
            background: rgba(255,255,255,0.8);
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            min-width: 300px;
            text-align: center;
        }
        .modal input {
            width: 80%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .modal button {
            padding: 8px 16px;
            background: #2ea44f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px;
        }
        .dev-info {
            text-align: left;
            margin: 10px 0;
        }
        .dev-info div {
            margin: 5px 0;
            padding: 5px;
            background: #f6f8fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- è®¿é—®å¯†ç å¼¹çª— -->
    <div id="accessModal" class="modal">
        <div class="modal-content">
            <h3>è¯·è¾“å…¥è®¿é—®å¯†ç </h3>
            <input type="password" id="accessPassword" placeholder="è¾“å…¥å¯†ç ">
            <div>
                <button onclick="checkAccessPassword()">è¿›å…¥</button>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤å¯†ç å¼¹çª— -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>è¯·è¾“å…¥åˆ é™¤å¯†ç </h3>
            <input type="password" id="deletePassword" placeholder="è¾“å…¥å¯†ç ">
            <div>
                <button onclick="confirmDelete()">ç¡®è®¤åˆ é™¤</button>
                <button onclick="cancelDelete()" style="background: #6c757d;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- å¼€å‘è€…æ¨¡å¼å¼¹çª— -->
    <div id="devModal" class="modal">
        <div class="modal-content">
            <h3>å¼€å‘è€…ä¿¡æ¯</h3>
            <div class="dev-info">
                <div><strong>ä½œè€…:</strong> Coaels</div>
                <div><strong>ç‰ˆæœ¬:</strong> 1.0.0beta</div>
                <div><strong>ä»“åº“åœ°å€:</strong> https://github.com/Coaels/Coaels.github.io</div>
                <div><strong>ä»¤ç‰ŒçŠ¶æ€:</strong> <span id="tokenStatus">å·²é…ç½®</span></div>
                <div><strong>æ–‡ä»¶æ•°é‡:</strong> <span id="fileCount">0</span></div>
                <div><strong>æœ€åæ›´æ–°:</strong> <span id="lastUpdate">-</span></div>
            </div>
            <button onclick="closeDevModal()">å…³é—­</button>
        </div>
    </div>

    <div class="header">GitHubç½‘ç›˜</div>
    <div class="container">
        <div class="upload-section">
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div>ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ æˆ– æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œ</div>
                <div style="font-size: 12px; color: #666;">æ”¯æŒå¤šé€‰ (Ctrl+ç‚¹å‡» æˆ– æ‹–æ‹½å¤šä¸ªæ–‡ä»¶)</div>
            </div>
            
            <input type="file" id="fileInput" multiple style="display: none">
            
            <div id="selectedFiles" class="selected-files" style="display: none;">
                <div id="filesList"></div>
                <div id="totalSize" style="font-weight: bold; margin-top: 5px;"></div>
            </div>
            
            <!-- æŒ‰é’®æ”¾åœ¨åŒä¸€è¡Œ -->
            <div class="button-row">
                <button class="confirm-btn" onclick="uploadFiles()">ä¸Šä¼ æ–‡ä»¶</button>
                <button class="refresh-btn" onclick="loadFileList()">åˆ·æ–°åˆ—è¡¨</button>
            </div>
            
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            
            <div class="notice">
                <strong>æ³¨æ„ï¼š</strong>ä¸Šä¼ /åˆ é™¤æ“ä½œåéœ€è¦ç­‰å¾…1åˆ†é’Ÿå·¦å³ï¼Œç„¶åç‚¹å‡»"åˆ·æ–°åˆ—è¡¨"æ‰èƒ½çœ‹åˆ°æ–‡ä»¶å˜åŠ¨
            </div>
            
            <div id="statusMsg"></div>
        </div>
        
        <div class="list-section">
            <div id="fileList"></div>
            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
    <div class="version" id="versionText" onclick="handleVersionClick()">v1.0.0beta</div>

    <script>
        // é…ç½® - ç»Ÿä¸€å¯†ç è®¾ç½®
        const ACCESS_PASSWORD = 'coaels';        // è®¿é—®å¯†ç 
        const DELETE_PASSWORD = 'hd130818';      // åˆ é™¤å¯†ç 
        const DEVELOPER_PASSWORD = 'hd130818';   // å¼€å‘è€…å¯†ç 
        const VERSION = '1.0.0beta';
        const TOKEN_PARTS = [
            'ghp_',
            'dJk2wJQECl7M4',
            'U4Gr2fntaWud5',
            'NhA70VLUMc'
        ];
        
        const GITHUB_TOKEN = TOKEN_PARTS.join('');
        const REPO_OWNER = 'Coaels';
        const REPO_NAME = 'Coaels.github.io';
        const BRANCH = 'main';
        const PAGE_SIZE = 6;

        const HIDDEN_FILES = [
            'index.html',
            'file-manager.html'
        ];

        // çŠ¶æ€å˜é‡
        let currentPage = 1;
        let allFiles = [];
        let selectedFiles = [];
        let versionClickCount = 0;
        let lastClickTime = 0;
        let pendingDeleteFile = null;

        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            showAccessModal();
        });

        // æ˜¾ç¤ºè®¿é—®å¯†ç å¼¹çª—
        function showAccessModal() {
            document.getElementById('accessModal').style.display = 'flex';
        }

        // æ£€æŸ¥è®¿é—®å¯†ç 
        function checkAccessPassword() {
            const password = document.getElementById('accessPassword').value;
            if (password === ACCESS_PASSWORD) {
                document.getElementById('accessModal').style.display = 'none';
                loadFileList();
            } else {
                alert('å¯†ç é”™è¯¯ï¼');
            }
        }

        // ç‰ˆæœ¬ç‚¹å‡»å¤„ç†
        function handleVersionClick() {
            const now = Date.now();
            if (now - lastClickTime > 1000) {
                versionClickCount = 0;
            }
            versionClickCount++;
            lastClickTime = now;

            if (versionClickCount >= 8) {
                const devPassword = prompt('è¯·è¾“å…¥å¼€å‘è€…å¯†ç ï¼š');
                if (devPassword === DEVELOPER_PASSWORD) {
                    showDevModal();
                } else {
                    alert('å¯†ç é”™è¯¯ï¼');
                }
                versionClickCount = 0;
            }
        }

        // æ˜¾ç¤ºå¼€å‘è€…ä¿¡æ¯å¼¹çª—
        function showDevModal() {
            document.getElementById('fileCount').textContent = allFiles.length;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
            document.getElementById('devModal').style.display = 'flex';
        }

        // å…³é—­å¼€å‘è€…å¼¹çª—
        function closeDevModal() {
            document.getElementById('devModal').style.display = 'none';
        }

        // åˆ é™¤æ–‡ä»¶å¯†ç éªŒè¯
        function deleteFile(file) {
            if (isHiddenFile(file.name)) {
                if (!confirm(`è­¦å‘Šï¼šè¿™æ˜¯ç³»ç»Ÿæ–‡ä»¶ï¼\nç¡®å®šåˆ é™¤ ${file.name}ï¼Ÿ`)) return;
            }
            
            pendingDeleteFile = file;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function confirmDelete() {
            const password = document.getElementById('deletePassword').value;
            if (password === DELETE_PASSWORD) {
                document.getElementById('deleteModal').style.display = 'none';
                document.getElementById('deletePassword').value = '';
                performDelete(pendingDeleteFile);
            } else {
                alert('å¯†ç é”™è¯¯ï¼');
            }
        }

        function cancelDelete() {
            document.getElementById('deleteModal').style.display = 'none';
            document.getElementById('deletePassword').value = '';
            pendingDeleteFile = null;
        }

        async function performDelete(file) {
            showStatus('åˆ é™¤ä¸­...', 'info');
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${file.path}`,
                    {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `token ${GITHUB_TOKEN}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Delete ${file.name}`,
                            sha: file.sha,
                            branch: BRANCH
                        })
                    }
                );
                
                if (response.ok) {
                    showStatus('åˆ é™¤æˆåŠŸï¼è¯·ç­‰å¾…çº¦1åˆ†é’Ÿåç‚¹å‡»"åˆ·æ–°åˆ—è¡¨"', true);
                } else {
                    showStatus('åˆ é™¤å¤±è´¥ï¼', false);
                }
            } catch (error) {
                showStatus('åˆ é™¤å¤±è´¥ï¼', false);
            }
        }

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('fileInput').addEventListener('change', (e) => {
            selectedFiles = Array.from(e.target.files);
            updateSelectedFilesList();
        });

        // æ‹–æ‹½åŠŸèƒ½
        const uploadArea = document.querySelector('.upload-area');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#2ea44f';
            uploadArea.style.background = '#f6ffed';
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ccc';
            uploadArea.style.background = '';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ccc';
            uploadArea.style.background = '';
            selectedFiles = Array.from(e.dataTransfer.files);
            updateSelectedFilesList();
        });

        // æ›´æ–°é€‰ä¸­çš„æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
        function updateSelectedFilesList() {
            const filesList = document.getElementById('filesList');
            const totalSize = document.getElementById('totalSize');
            const selectedFilesDiv = document.getElementById('selectedFiles');
            
            if (selectedFiles.length > 0) {
                let totalBytes = 0;
                filesList.innerHTML = selectedFiles.map(file => {
                    totalBytes += file.size;
                    return `<div class="file-info">ğŸ“„ ${file.name} (${formatFileSize(file.size)})</div>`;
                }).join('');
                
                totalSize.textContent = `å…± ${selectedFiles.length} ä¸ªæ–‡ä»¶ï¼Œæ€»å¤§å°: ${formatFileSize(totalBytes)}`;
                selectedFilesDiv.style.display = 'block';
            } else {
                selectedFilesDiv.style.display = 'none';
            }
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showStatus(message, isSuccess) {
            const statusMsg = document.getElementById('statusMsg');
            const type = isSuccess === true ? 'success' : isSuccess === false ? 'error' : 'info';
            statusMsg.innerHTML = `<div class="status-msg ${type}">${message}</div>`;
            if (isSuccess !== 'info') {
                setTimeout(() => { statusMsg.innerHTML = ''; }, 5000);
            }
        }

        // æ‰¹é‡ä¸Šä¼ æ–‡ä»¶
        async function uploadFiles() {
            if (selectedFiles.length === 0) {
                showStatus('è¯·å…ˆé€‰æ‹©æ–‡ä»¶ï¼', false);
                return;
            }

            showStatus(`å¼€å§‹ä¸Šä¼  ${selectedFiles.length} ä¸ªæ–‡ä»¶...`, 'info');
            
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            progressBar.style.display = 'block';
            
            let successCount = 0;
            let failCount = 0;

            for (let i = 0; i < selectedFiles.length; i++) {
                const file = selectedFiles[i];
                try {
                    await uploadSingleFile(file);
                    successCount++;
                } catch (error) {
                    console.error(`ä¸Šä¼ å¤±è´¥ ${file.name}:`, error);
                    failCount++;
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                const progress = ((i + 1) / selectedFiles.length) * 100;
                progressFill.style.width = `${progress}%`;
            }

            // éšè—è¿›åº¦æ¡
            setTimeout(() => {
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
            }, 2000);

            // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
            let resultMessage = `ä¸Šä¼ å®Œæˆï¼æˆåŠŸ: ${successCount}ä¸ª`;
            if (failCount > 0) {
                resultMessage += `ï¼Œå¤±è´¥: ${failCount}ä¸ª`;
            }
            resultMessage += 'ï¼Œè¯·ç­‰å¾…çº¦1åˆ†é’Ÿåç‚¹å‡»"åˆ·æ–°åˆ—è¡¨"';
            
            showStatus(resultMessage, failCount === 0);
            
            // æ¸…ç©ºå·²é€‰æ–‡ä»¶
            selectedFiles = [];
            document.getElementById('fileInput').value = '';
            updateSelectedFilesList();
        }

        // ä¸Šä¼ å•ä¸ªæ–‡ä»¶
        async function uploadSingleFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async () => {
                    try {
                        const content = reader.result.split(',')[1];
                        await uploadToGitHub(file.name, content);
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = () => reject(reader.error);
                reader.readAsDataURL(file);
            });
        }

        async function uploadToGitHub(filename, content) {
            const response = await fetch(
                `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filename}`,
                {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Add ${filename}`,
                        content: content,
                        branch: BRANCH
                    })
                }
            );
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            return response.json();
        }

        // ä¸‹è½½åŠŸèƒ½
        function downloadFile(file) {
            const downloadUrl = `https://github.com/${REPO_OWNER}/${REPO_NAME}/raw/main/${file.path}`;
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = downloadUrl;
            document.body.appendChild(iframe);
            
            setTimeout(() => {
                window.open(downloadUrl, '_blank');
            }, 1000);
        }

        function isHiddenFile(filename) {
            return HIDDEN_FILES.includes(filename);
        }

        async function loadFileList() {
            showStatus('åŠ è½½æ–‡ä»¶åˆ—è¡¨ä¸­...', 'info');
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/`,
                    { headers: { 'Authorization': `token ${GITHUB_TOKEN}` } }
                );
                
                if (!response.ok) {
                    throw new Error('APIè¯·æ±‚å¤±è´¥');
                }
                
                const allFilesData = await response.json();
                
                allFiles = allFilesData.filter(file => !isHiddenFile(file.name));
                renderFileList();
                showStatus('æ–‡ä»¶åˆ—è¡¨å·²æ›´æ–°ï¼', true);
            } catch (error) {
                console.error('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', error);
                showStatus('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥Tokenæˆ–ç½‘ç»œ', false);
            }
        }

        function renderFileList() {
            const startIndex = (currentPage - 1) * PAGE_SIZE;
            const pageFiles = allFiles.slice(startIndex, startIndex + PAGE_SIZE);
            
            const fileList = document.getElementById('fileList');
            
            if (pageFiles.length === 0) {
                fileList.innerHTML = '<div class="status-msg info">æš‚æ— æ–‡ä»¶</div>';
            } else {
                fileList.innerHTML = pageFiles.map(file => `
                    <div class="file-item">
                        <span>${file.name}</span>
                        <div>
                            <button class="download-btn" onclick="downloadFile(${JSON.stringify(file).replace(/"/g, '&quot;')})">
                                ä¸‹è½½
                            </button>
                            <button class="delete-btn" onclick="deleteFile(${JSON.stringify(file).replace(/"/g, '&quot;')})">
                                åˆ é™¤
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            renderPagination();
        }

        function renderPagination() {
            const totalPages = Math.ceil(allFiles.length / PAGE_SIZE);
            const pagination = document.getElementById('pagination');
            
            let paginationHTML = '';
            if (currentPage > 1) {
                paginationHTML += `<button onclick="changePage(${currentPage - 1})">ä¸Šä¸€é¡µ</button>`;
            }
            
            paginationHTML += `<span>ç¬¬ ${currentPage} é¡µ / å…± ${totalPages} é¡µ (å…± ${allFiles.length} ä¸ªæ–‡ä»¶)</span>`;
            
            if (currentPage < totalPages) {
                paginationHTML += `<button onclick="changePage(${currentPage + 1})">ä¸‹ä¸€é¡µ</button>`;
            }
            
            pagination.innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            renderFileList();
        }
    </script>
</body>
</html>

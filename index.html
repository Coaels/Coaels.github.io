<!DOCTYPE html>
<html>
<head>
    <title>GitHubç½‘ç›˜</title>
    <style>
        :root { --primary: #2ea44f; --danger: #cf222e; --info: #0366d6; }
        body { margin: 0; font-family: Arial; }
        .header { background: #24292e; color: white; padding: 20px; text-align: center; font-size: 24px; font-weight: bold; }
        .container { display: flex; height: calc(100vh - 80px); }
        .upload-section { width: 30%; padding: 20px; border-right: 1px solid #ddd; box-sizing: border-box; }
        .list-section { width: 70%; padding: 20px; overflow-y: auto; box-sizing: border-box; }
        .upload-area { width: 100%; padding: 15px; margin-bottom: 10px; border: 2px dashed #ccc; border-radius: 5px; text-align: center; cursor: pointer; box-sizing: border-box; }
        .upload-hint { font-size: 12px; color: #e74c3c; margin-top: 5px; }
        .button-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .btn { flex: 1; padding: 10px; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: var(--primary); }
        .btn-info { background: var(--info); }
        .btn-danger { background: var(--danger); }
        .file-item { border: 1px solid #e1e4e8; padding: 15px; margin-bottom: 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
        .selected-files { max-height: 150px; overflow-y: auto; margin: 10px 0; padding: 10px; border: 1px solid #e1e4e8; border-radius: 4px; background: #f6f8fa; display: none; }
        .file-info { font-size: 12px; padding: 2px 0; }
        .pagination { margin-top: 20px; text-align: center; }
        .status-msg { padding: 10px; margin: 10px 0; border-radius: 4px; text-align: center; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #cce7ff; color: #004085; }
        .notice { background: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; margin: 10px 0; text-align: center; border: 1px solid #ffeaa7; }
        .version { position: fixed; bottom: 10px; left: 10px; font-size: 12px; color: #666; background: rgba(255,255,255,0.8); padding: 2px 6px; border-radius: 3px; cursor: pointer; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; min-width: 300px; text-align: center; }
        .modal input { width: 80%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="accessModal" class="modal">
        <div class="modal-content">
            <h3>è¯·è¾“å…¥è®¿é—®å¯†ç </h3>
            <input type="password" id="accessPassword" placeholder="è¾“å…¥å¯†ç ">
            <button class="btn btn-primary" onclick="checkAccessPassword()">è¿›å…¥</button>
        </div>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>è¯·è¾“å…¥åˆ é™¤å¯†ç </h3>
            <input type="password" id="deletePassword" placeholder="è¾“å…¥å¯†ç ">
            <div>
                <button class="btn btn-danger" onclick="confirmDelete()">ç¡®è®¤åˆ é™¤</button>
                <button class="btn" onclick="cancelDelete()" style="background: #6c757d;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div class="header">GitHubç½‘ç›˜</div>
    <div class="container">
        <div class="upload-section">
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div>ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ æˆ– æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œ</div>
                <div class="upload-hint">ä»…æ”¯æŒ30MBä»¥å†…å¤§å°æ–‡ä»¶ï¼Œå¯åˆ†å·å‹ç¼©åä¸Šä¼ </div>
            </div>
            
            <input type="file" id="fileInput" multiple style="display: none">
            
            <div id="selectedFiles" class="selected-files">
                <div id="filesList"></div>
                <div id="totalSize" style="font-weight: bold; margin-top: 5px;"></div>
            </div>
            
            <div class="button-row">
                <button class="btn btn-primary" onclick="uploadFiles()">ä¸Šä¼ æ–‡ä»¶</button>
                <button class="btn btn-info" onclick="loadFileList()">åˆ·æ–°åˆ—è¡¨</button>
            </div>
            
            <div class="notice">
                <strong>æ³¨æ„ï¼š</strong>ä¸Šä¼ /åˆ é™¤æ“ä½œåéœ€è¦ç­‰å¾…1åˆ†é’Ÿå·¦å³ï¼Œç„¶åç‚¹å‡»"åˆ·æ–°åˆ—è¡¨"æ‰èƒ½çœ‹åˆ°æ–‡ä»¶å˜åŠ¨
            </div>
            
            <div id="statusMsg"></div>
        </div>
        
        <div class="list-section">
            <div id="fileList"></div>
            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <div class="version" onclick="handleVersionClick()">v1.0.0beta</div>

    <script>
        // é…ç½®
        const CONFIG = {
            ACCESS_PASSWORD: 'coaels',
            DELETE_PASSWORD: 'hd130818',
            DEVELOPER_PASSWORD: 'hd130818',
            MAX_FILE_SIZE: 30 * 1024 * 1024, // 30MB
            TOKEN: ['ghp_', 'dJk2wJQECl7M4', 'U4Gr2fntaWud5', 'NhA70VLUMc'].join(''),
            REPO_OWNER: 'Coaels',
            REPO_NAME: 'Coaels.github.io',
            BRANCH: 'main',
            PAGE_SIZE: 6,
            HIDDEN_FILES: ['index.html', 'file-manager.html']
        };

        let state = {
            currentPage: 1,
            allFiles: [],
            selectedFiles: [],
            versionClickCount: 0,
            lastClickTime: 0,
            pendingDeleteFile: null
        };

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            document.getElementById('accessModal').style.display = 'flex';
            initEventListeners();
        });

        function initEventListeners() {
            // æ–‡ä»¶é€‰æ‹©
            document.getElementById('fileInput').addEventListener('change', (e) => {
                state.selectedFiles = Array.from(e.target.files);
                checkFileSizes();
                updateSelectedFilesList();
            });

            // æ‹–æ‹½åŠŸèƒ½
            const uploadArea = document.querySelector('.upload-area');
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = CONFIG.primary;
            });
            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#ccc';
            });
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#ccc';
                state.selectedFiles = Array.from(e.dataTransfer.files);
                checkFileSizes();
                updateSelectedFilesList();
            });

            // å›è½¦é”®æ”¯æŒ
            document.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !document.getElementById('accessModal').style.display) {
                    uploadFiles();
                }
            });
        }

        function checkFileSizes() {
            const oversizedFiles = state.selectedFiles.filter(file => file.size > CONFIG.MAX_FILE_SIZE);
            if (oversizedFiles.length > 0) {
                showStatus(`å‘ç° ${oversizedFiles.length} ä¸ªæ–‡ä»¶è¶…è¿‡30MBé™åˆ¶ï¼Œå·²è‡ªåŠ¨è¿‡æ»¤`, false);
                state.selectedFiles = state.selectedFiles.filter(file => file.size <= CONFIG.MAX_FILE_SIZE);
            }
        }

        function checkAccessPassword() {
            const password = document.getElementById('accessPassword').value;
            if (password === CONFIG.ACCESS_PASSWORD) {
                document.getElementById('accessModal').style.display = 'none';
                loadFileList();
            } else {
                alert('å¯†ç é”™è¯¯ï¼');
            }
        }

        function handleVersionClick() {
            const now = Date.now();
            if (now - state.lastClickTime > 1000) state.versionClickCount = 0;
            state.versionClickCount++;
            state.lastClickTime = now;

            if (state.versionClickCount >= 8) {
                const devPassword = prompt('è¯·è¾“å…¥å¼€å‘è€…å¯†ç ï¼š');
                if (devPassword === CONFIG.DEVELOPER_PASSWORD) {
                    alert(`å¼€å‘è€…ä¿¡æ¯\nä½œè€…: Coaels\næ–‡ä»¶æ•°é‡: ${state.allFiles.length}`);
                } else {
                    alert('å¯†ç é”™è¯¯ï¼');
                }
                state.versionClickCount = 0;
            }
        }

        function updateSelectedFilesList() {
            const container = document.getElementById('selectedFiles');
            if (state.selectedFiles.length === 0) {
                container.style.display = 'none';
                return;
            }

            let totalBytes = 0;
            document.getElementById('filesList').innerHTML = state.selectedFiles.map(file => {
                totalBytes += file.size;
                const warn = file.size > CONFIG.MAX_FILE_SIZE ? ' âŒè¶…é™' : '';
                return `<div class="file-info">ğŸ“„ ${file.name} (${formatFileSize(file.size)}${warn})</div>`;
            }).join('');

            document.getElementById('totalSize').textContent = 
                `å…± ${state.selectedFiles.length} ä¸ªæ–‡ä»¶ï¼Œæ€»å¤§å°: ${formatFileSize(totalBytes)}`;
            container.style.display = 'block';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showStatus(message, isSuccess) {
            const type = isSuccess === true ? 'success' : isSuccess === false ? 'error' : 'info';
            document.getElementById('statusMsg').innerHTML = 
                `<div class="status-msg ${type}">${message}</div>`;
            if (isSuccess !== 'info') {
                setTimeout(() => { document.getElementById('statusMsg').innerHTML = ''; }, 5000);
            }
        }

        async function uploadFiles() {
            if (state.selectedFiles.length === 0) {
                showStatus('è¯·å…ˆé€‰æ‹©æ–‡ä»¶ï¼', false);
                return;
            }

            // è¿‡æ»¤è¶…é™æ–‡ä»¶
            const validFiles = state.selectedFiles.filter(file => file.size <= CONFIG.MAX_FILE_SIZE);
            if (validFiles.length === 0) {
                showStatus('æ²¡æœ‰ç¬¦åˆå¤§å°é™åˆ¶çš„æ–‡ä»¶å¯ä¸Šä¼ ï¼', false);
                return;
            }

            showStatus(`å¼€å§‹ä¸Šä¼  ${validFiles.length} ä¸ªæ–‡ä»¶...`, 'info');
            
            let successCount = 0;
            for (const file of validFiles) {
                try {
                    await uploadSingleFile(file);
                    successCount++;
                } catch (error) {
                    console.error(`ä¸Šä¼ å¤±è´¥ ${file.name}:`, error);
                }
            }

            showStatus(`ä¸Šä¼ å®Œæˆï¼æˆåŠŸ: ${successCount}ä¸ªï¼Œè¯·ç­‰å¾…çº¦1åˆ†é’Ÿååˆ·æ–°åˆ—è¡¨`, successCount > 0);
            state.selectedFiles = [];
            document.getElementById('fileInput').value = '';
            updateSelectedFilesList();
        }

        async function uploadSingleFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async () => {
                    try {
                        const content = reader.result.split(',')[1];
                        await uploadToGitHub(file.name, content);
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        async function uploadToGitHub(filename, content) {
            const response = await fetch(
                `https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/contents/${filename}`,
                {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${CONFIG.TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Add ${filename}`,
                        content: content,
                        branch: CONFIG.BRANCH
                    })
                }
            );
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return response.json();
        }

        function downloadFile(file) {
            const url = `https://github.com/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/raw/main/${file.path}`;
            window.open(url, '_blank');
        }

        function deleteFile(file) {
            if (CONFIG.HIDDEN_FILES.includes(file.name) && !confirm(`è­¦å‘Šï¼šç³»ç»Ÿæ–‡ä»¶ï¼ç¡®å®šåˆ é™¤ ${file.name}ï¼Ÿ`)) return;
            state.pendingDeleteFile = file;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function confirmDelete() {
            const password = document.getElementById('deletePassword').value;
            if (password === CONFIG.DELETE_PASSWORD) {
                document.getElementById('deleteModal').style.display = 'none';
                document.getElementById('deletePassword').value = '';
                performDelete(state.pendingDeleteFile);
            } else {
                alert('å¯†ç é”™è¯¯ï¼');
            }
        }

        function cancelDelete() {
            document.getElementById('deleteModal').style.display = 'none';
            document.getElementById('deletePassword').value = '';
            state.pendingDeleteFile = null;
        }

        async function performDelete(file) {
            showStatus('åˆ é™¤ä¸­...', 'info');
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/contents/${file.path}`,
                    {
                        method: 'DELETE',
                        headers: { 'Authorization': `token ${CONFIG.TOKEN}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: `Delete ${file.name}`,
                            sha: file.sha,
                            branch: CONFIG.BRANCH
                        })
                    }
                );
                showStatus(response.ok ? 'åˆ é™¤æˆåŠŸï¼è¯·ç­‰å¾…çº¦1åˆ†é’Ÿååˆ·æ–°åˆ—è¡¨' : 'åˆ é™¤å¤±è´¥ï¼', response.ok);
            } catch (error) {
                showStatus('åˆ é™¤å¤±è´¥ï¼', false);
            }
        }

        async function loadFileList() {
            showStatus('åŠ è½½æ–‡ä»¶åˆ—è¡¨ä¸­...', 'info');
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/contents/`,
                    { headers: { 'Authorization': `token ${CONFIG.TOKEN}` } }
                );
                state.allFiles = (await response.json()).filter(file => !CONFIG.HIDDEN_FILES.includes(file.name));
                renderFileList();
                showStatus('æ–‡ä»¶åˆ—è¡¨å·²æ›´æ–°ï¼', true);
            } catch (error) {
                showStatus('åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', false);
            }
        }

        function renderFileList() {
            const start = (state.currentPage - 1) * CONFIG.PAGE_SIZE;
            const pageFiles = state.allFiles.slice(start, start + CONFIG.PAGE_SIZE);
            const fileList = document.getElementById('fileList');
            
            fileList.innerHTML = pageFiles.length ? pageFiles.map(file => `
                <div class="file-item">
                    <span>${file.name}</span>
                    <div>
                        <button class="btn btn-primary" onclick="downloadFile(${JSON.stringify(file).replace(/"/g, '&quot;')})">ä¸‹è½½</button>
                        <button class="btn btn-danger" onclick="deleteFile(${JSON.stringify(file).replace(/"/g, '&quot;')})">åˆ é™¤</button>
                    </div>
                </div>
            `).join('') : '<div class="status-msg info">æš‚æ— æ–‡ä»¶</div>';

            renderPagination();
        }

        function renderPagination() {
            const totalPages = Math.ceil(state.allFiles.length / CONFIG.PAGE_SIZE);
            const pagination = document.getElementById('pagination');
            let html = '';
            
            if (state.currentPage > 1) html += `<button class="btn" onclick="changePage(${state.currentPage - 1})">ä¸Šä¸€é¡µ</button>`;
            html += `<span style="margin: 0 10px;">ç¬¬ ${state.currentPage} é¡µ / å…± ${totalPages} é¡µ</span>`;
            if (state.currentPage < totalPages) html += `<button class="btn" onclick="changePage(${state.currentPage + 1})">ä¸‹ä¸€é¡µ</button>`;
            
            pagination.innerHTML = html;
        }

        function changePage(page) {
            state.currentPage = page;
            renderFileList();
        }
    </script>
</body>
</html>

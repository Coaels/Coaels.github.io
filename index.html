<!DOCTYPE html>
<html>
<head>
    <title>GitHubç½‘ç›˜</title>
    <style>
        :root {
            --primary: #2ea44f;
            --danger: #cf222e;
            --info: #0366d6;
            --border: #e1e4e8;
            --bg: #f6f8fa;
        }
        body { margin: 0; font-family: Arial; }
        .header { background: #24292e; color: white; padding: 20px; text-align: center; font-size: 24px; }
        .container { display: flex; height: calc(100vh - 80px); }
        .upload-section { width: 30%; padding: 20px; border-right: 1px solid var(--border); box-sizing: border-box; }
        .list-section { width: 70%; padding: 20px; overflow-y: auto; box-sizing: border-box; }
        .upload-area { 
            width: 100%; padding: 15px; margin-bottom: 10px; border: 2px dashed #ccc; border-radius: 5px; 
            text-align: center; cursor: pointer; box-sizing: border-box; background: var(--bg);
        }
        .upload-note { font-size: 12px; color: #666; margin: 5px 0; }
        .button-row { display: flex; gap: 10px; margin: 10px 0; }
        .btn { flex: 1; padding: 10px; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: var(--primary); }
        .btn-info { background: var(--info); }
        .file-item { border: 1px solid var(--border); padding: 15px; margin-bottom: 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
        .selected-files { max-height: 150px; overflow-y: auto; margin: 10px 0; padding: 10px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg); }
        .file-info { font-size: 12px; padding: 2px 0; }
        .pagination { margin-top: 20px; text-align: center; }
        .page-btn { margin: 0 5px; padding: 8px 12px; border: 1px solid #ddd; background: var(--bg); cursor: pointer; }
        .action-btn { padding: 6px 12px; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 8px; }
        .download-btn { background: var(--primary); }
        .delete-btn { background: var(--danger); }
        .status-msg { padding: 10px; margin: 10px 0; border-radius: 4px; text-align: center; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #cce7ff; color: #004085; }
        .notice { background: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; margin: 10px 0; text-align: center; border: 1px solid #ffeaa7; }
        .version { position: fixed; bottom: 10px; left: 10px; font-size: 12px; color: #666; background: rgba(255,255,255,0.8); padding: 2px 6px; border-radius: 3px; cursor: pointer; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; min-width: 300px; text-align: center; }
        .modal input { width: 80%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
        .modal button { padding: 8px 16px; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 0 5px; }
        .dev-info { text-align: left; margin: 10px 0; }
        .dev-info div { margin: 5px 0; padding: 5px; background: var(--bg); border-radius: 4px; }
    </style>
</head>
<body>
    <!-- å¼¹çª— -->
    <div id="accessModal" class="modal"><div class="modal-content">
        <h3>è¯·è¾“å…¥è®¿é—®å¯†ç </h3><input type="password" id="accessPassword" placeholder="è¾“å…¥å¯†ç ">
        <div><button onclick="checkAccessPassword()" style="background:var(--primary)">è¿›å…¥</button></div>
    </div></div>

    <div id="deleteModal" class="modal"><div class="modal-content">
        <h3>è¯·è¾“å…¥åˆ é™¤å¯†ç </h3><input type="password" id="deletePassword" placeholder="è¾“å…¥å¯†ç ">
        <div><button onclick="confirmDelete()" style="background:var(--primary)">ç¡®è®¤åˆ é™¤</button>
        <button onclick="cancelDelete()" style="background:#6c757d">å–æ¶ˆ</button></div>
    </div></div>

    <div id="devModal" class="modal"><div class="modal-content">
        <h3>å¼€å‘è€…ä¿¡æ¯</h3><div class="dev-info">
            <div><strong>ä½œè€…:</strong> Coaels</div><div><strong>ç‰ˆæœ¬:</strong> 1.0.0beta</div>
            <div><strong>ä»“åº“:</strong> https://github.com/Coaels/Coaels.github.io</div>
            <div><strong>æ–‡ä»¶æ•°é‡:</strong> <span id="fileCount">0</span></div>
            <div><strong>æœ€åæ›´æ–°:</strong> <span id="lastUpdate">-</span></div>
        </div><button onclick="closeDevModal()" style="background:var(--primary)">å…³é—­</button>
    </div></div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="header">GitHubç½‘ç›˜</div>
    <div class="container">
        <div class="upload-section">
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div>ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ æˆ– æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œ</div>
                <div class="upload-note">ä»…æ”¯æŒ35MBä»¥å†…å¤§å°æ–‡ä»¶ï¼Œå¯åˆ†å·å‹ç¼©åä¸Šä¼ </div>
            </div>
            
            <input type="file" id="fileInput" multiple style="display: none">
            
            <div id="selectedFiles" class="selected-files" style="display: none;">
                <div id="filesList"></div>
                <div id="totalSize" style="font-weight: bold; margin-top: 5px;"></div>
            </div>
            
            <div class="button-row">
                <button class="btn btn-primary" onclick="uploadFiles()">ä¸Šä¼ æ–‡ä»¶</button>
                <button class="btn btn-info" onclick="loadFileList()">åˆ·æ–°åˆ—è¡¨</button>
            </div>
            
            <div class="notice">
                <strong>æ³¨æ„ï¼š</strong>æ“ä½œåéœ€ç­‰å¾…1åˆ†é’Ÿï¼Œç„¶ååˆ·æ–°åˆ—è¡¨
            </div>
            
            <div id="statusMsg"></div>
        </div>
        
        <div class="list-section">
            <div id="fileList"></div>
            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <div class="version" onclick="handleVersionClick()">v1.0.0beta</div>

    <script>
        // é…ç½®
        const CONFIG = {
            ACCESS_PASSWORD: 'coaels',
            DELETE_PASSWORD: 'hd130818',
            DEVELOPER_PASSWORD: 'hd130818',
            MAX_FILE_SIZE: 35 * 1024 * 1024, // 35MB
            TOKEN: ['ghp_','dJk2wJQECl7M4','U4Gr2fntaWud5','NhA70VLUMc'].join(''),
            REPO_OWNER: 'Coaels',
            REPO_NAME: 'Coaels.github.io',
            BRANCH: 'main',
            PAGE_SIZE: 6,
            HIDDEN_FILES: ['index.html', 'file-manager.html']
        };

        // çŠ¶æ€
        let state = {
            currentPage: 1,
            allFiles: [],
            selectedFiles: [],
            versionClickCount: 0,
            lastClickTime: 0,
            pendingDeleteFile: null
        };

        // å·¥å…·å‡½æ•°
        const utils = {
            formatSize: bytes => {
                if (bytes === 0) return '0 B';
                const k = 1024, sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            },
            showStatus: (message, type = 'info') => {
                const statusMsg = document.getElementById('statusMsg');
                const colors = { success: '#d4edda', error: '#f8d7da', info: '#cce7ff' };
                statusMsg.innerHTML = `<div class="status-msg" style="background:${colors[type]}">${message}</div>`;
                if (type !== 'info') setTimeout(() => statusMsg.innerHTML = '', 5000);
            },
            isHiddenFile: filename => CONFIG.HIDDEN_FILES.includes(filename)
        };

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            document.getElementById('accessModal').style.display = 'flex';
        });

        // å¯†ç éªŒè¯
        function checkAccessPassword() {
            const password = document.getElementById('accessPassword').value;
            if (password === CONFIG.ACCESS_PASSWORD) {
                document.getElementById('accessModal').style.display = 'none';
                loadFileList();
            } else alert('å¯†ç é”™è¯¯ï¼');
        }

        // å¼€å‘è€…æ¨¡å¼
        function handleVersionClick() {
            const now = Date.now();
            if (now - state.lastClickTime > 1000) state.versionClickCount = 0;
            state.versionClickCount++;
            state.lastClickTime = now;

            if (state.versionClickCount >= 8) {
                const devPassword = prompt('è¯·è¾“å…¥å¼€å‘è€…å¯†ç ï¼š');
                if (devPassword === CONFIG.DEVELOPER_PASSWORD) showDevModal();
                else alert('å¯†ç é”™è¯¯ï¼');
                state.versionClickCount = 0;
            }
        }

        function showDevModal() {
            document.getElementById('fileCount').textContent = state.allFiles.length;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
            document.getElementById('devModal').style.display = 'flex';
        }

        function closeDevModal() {
            document.getElementById('devModal').style.display = 'none';
        }

        // æ–‡ä»¶æ“ä½œ
        function deleteFile(file) {
            if (utils.isHiddenFile(file.name) && !confirm(`è­¦å‘Šï¼šç³»ç»Ÿæ–‡ä»¶ï¼\nç¡®å®šåˆ é™¤ ${file.name}ï¼Ÿ`)) return;
            state.pendingDeleteFile = file;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function confirmDelete() {
            const password = document.getElementById('deletePassword').value;
            if (password === CONFIG.DELETE_PASSWORD) {
                document.getElementById('deleteModal').style.display = 'none';
                document.getElementById('deletePassword').value = '';
                performDelete(state.pendingDeleteFile);
            } else alert('å¯†ç é”™è¯¯ï¼');
        }

        function cancelDelete() {
            document.getElementById('deleteModal').style.display = 'none';
            document.getElementById('deletePassword').value = '';
            state.pendingDeleteFile = null;
        }

        async function performDelete(file) {
            utils.showStatus('åˆ é™¤ä¸­...', 'info');
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/contents/${file.path}`,
                    {
                        method: 'DELETE',
                        headers: { 'Authorization': `token ${CONFIG.TOKEN}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: `Delete ${file.name}`, sha: file.sha, branch: CONFIG.BRANCH })
                    }
                );
                utils.showStatus(response.ok ? 'åˆ é™¤æˆåŠŸï¼è¯·ç­‰å¾…1åˆ†é’Ÿååˆ·æ–°' : 'åˆ é™¤å¤±è´¥ï¼', response.ok ? 'success' : 'error');
            } catch (error) {
                utils.showStatus('åˆ é™¤å¤±è´¥ï¼', 'error');
            }
        }

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('fileInput').addEventListener('change', (e) => {
            state.selectedFiles = Array.from(e.target.files);
            updateSelectedFilesList();
        });

        // æ‹–æ‹½åŠŸèƒ½
        const uploadArea = document.querySelector('.upload-area');
        ['dragover', 'dragleave', 'drop'].forEach(event => {
            uploadArea.addEventListener(event, (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = event === 'dragover' ? '#2ea44f' : '#ccc';
                uploadArea.style.background = event === 'dragover' ? '#f6ffed' : '';
                if (event === 'drop') state.selectedFiles = Array.from(e.dataTransfer.files);
                if (event === 'drop') updateSelectedFilesList();
            });
        });

        function updateSelectedFilesList() {
            const filesList = document.getElementById('filesList');
            const totalSize = document.getElementById('totalSize');
            const selectedFilesDiv = document.getElementById('selectedFiles');
            
            if (state.selectedFiles.length > 0) {
                let totalBytes = 0;
                filesList.innerHTML = state.selectedFiles.map(file => {
                    totalBytes += file.size;
                    return `<div class="file-info">ğŸ“„ ${file.name} (${utils.formatSize(file.size)})</div>`;
                }).join('');
                
                totalSize.textContent = `å…± ${state.selectedFiles.length} ä¸ªæ–‡ä»¶ï¼Œæ€»å¤§å°: ${utils.formatSize(totalBytes)}`;
                selectedFilesDiv.style.display = 'block';
            } else selectedFilesDiv.style.display = 'none';
        }

        // æ–‡ä»¶ä¸Šä¼ 
        async function uploadFiles() {
            if (state.selectedFiles.length === 0) {
                utils.showStatus('è¯·å…ˆé€‰æ‹©æ–‡ä»¶ï¼', 'error');
                return;
            }

            // æ£€æŸ¥æ–‡ä»¶å¤§å°
            const oversizedFiles = state.selectedFiles.filter(file => file.size > CONFIG.MAX_FILE_SIZE);
            if (oversizedFiles.length > 0) {
                utils.showStatus(`æ–‡ä»¶ ${oversizedFiles[0].name} è¶…è¿‡35MBé™åˆ¶ï¼Œè¯·åˆ†å·å‹ç¼©åä¸Šä¼ ï¼`, 'error');
                return;
            }

            utils.showStatus(`ä¸Šä¼  ${state.selectedFiles.length} ä¸ªæ–‡ä»¶...`, 'info');
            
            let successCount = 0;
            for (let i = 0; i < state.selectedFiles.length; i++) {
                try {
                    await uploadSingleFile(state.selectedFiles[i]);
                    successCount++;
                } catch (error) {
                    console.error(`ä¸Šä¼ å¤±è´¥:`, error);
                }
            }

            const resultMessage = `ä¸Šä¼ å®Œæˆï¼æˆåŠŸ: ${successCount}ä¸ªï¼Œå¤±è´¥: ${state.selectedFiles.length - successCount}ä¸ªï¼Œè¯·ç­‰å¾…1åˆ†é’Ÿååˆ·æ–°`;
            utils.showStatus(resultMessage, successCount === state.selectedFiles.length ? 'success' : 'error');
            
            state.selectedFiles = [];
            document.getElementById('fileInput').value = '';
            updateSelectedFilesList();
        }

        async function uploadSingleFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async () => {
                    try {
                        const content = reader.result.split(',')[1];
                        await uploadToGitHub(file.name, content);
                        resolve();
                    } catch (error) { reject(error); }
                };
                reader.readAsDataURL(file);
            });
        }

        async function uploadToGitHub(filename, content) {
            const response = await fetch(
                `https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/contents/${filename}`,
                {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${CONFIG.TOKEN}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: `Add ${filename}`, content: content, branch: CONFIG.BRANCH })
                }
            );
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return response.json();
        }

        // ä¸‹è½½åŠŸèƒ½
        function downloadFile(file) {
            const downloadUrl = `https://github.com/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/raw/main/${file.path}`;
            window.open(downloadUrl, '_blank');
        }

        // æ–‡ä»¶åˆ—è¡¨
        async function loadFileList() {
            utils.showStatus('åŠ è½½æ–‡ä»¶åˆ—è¡¨ä¸­...', 'info');
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/contents/`,
                    { headers: { 'Authorization': `token ${CONFIG.TOKEN}` } }
                );
                const allFilesData = await response.json();
                state.allFiles = allFilesData.filter(file => !utils.isHiddenFile(file.name));
                renderFileList();
                utils.showStatus('æ–‡ä»¶åˆ—è¡¨å·²æ›´æ–°ï¼', 'success');
            } catch (error) {
                utils.showStatus('åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥Tokenæˆ–ç½‘ç»œ', 'error');
            }
        }

        function renderFileList() {
            const startIndex = (state.currentPage - 1) * CONFIG.PAGE_SIZE;
            const pageFiles = state.allFiles.slice(startIndex, startIndex + CONFIG.PAGE_SIZE);
            const fileList = document.getElementById('fileList');
            
            fileList.innerHTML = pageFiles.length === 0 ? 
                '<div class="status-msg info">æš‚æ— æ–‡ä»¶</div>' :
                pageFiles.map(file => `
                    <div class="file-item">
                        <span>${file.name}</span>
                        <div>
                            <button class="action-btn download-btn" onclick="downloadFile(${JSON.stringify(file).replace(/"/g, '&quot;')})">ä¸‹è½½</button>
                            <button class="action-btn delete-btn" onclick="deleteFile(${JSON.stringify(file).replace(/"/g, '&quot;')})">åˆ é™¤</button>
                        </div>
                    </div>
                `).join('');

            renderPagination();
        }

        function renderPagination() {
            const totalPages = Math.ceil(state.allFiles.length / CONFIG.PAGE_SIZE);
            const pagination = document.getElementById('pagination');
            let html = '';
            if (state.currentPage > 1) html += `<button class="page-btn" onclick="changePage(${state.currentPage - 1})">ä¸Šä¸€é¡µ</button>`;
            html += `<span>ç¬¬ ${state.currentPage} é¡µ / å…± ${totalPages} é¡µ (${state.allFiles.length} æ–‡ä»¶)</span>`;
            if (state.currentPage < totalPages) html += `<button class="page-btn" onclick="changePage(${state.currentPage + 1})">ä¸‹ä¸€é¡µ</button>`;
            pagination.innerHTML = html;
        }

        function changePage(page) {
            state.currentPage = page;
            renderFileList();
        }
    </script>
</body>
</html>
